import streamlit as st
from datetime import date, datetime
import time
import os

# ============================================================================
# [1. í˜ì´ì§€ ì„¤ì • ë° ë””ìì¸ (ëª¨ë°”ì¼ ê°€ë…ì„± ìµœì í™”)]
# ============================================================================
st.set_page_config(page_title="ì‚¬ì£¼ê¹Œê¸° PRO - ë§ˆìŠ¤í„° í‰ìƒ ìš´ì„¸", layout="wide")

st.markdown("""
    <style>
    /* [ì „ì²´ í…Œë§ˆ] ê¹Šì€ ë°¤í•˜ëŠ˜ìƒ‰ */
    .main { background-color: #0f172a; color: white; }
    
    /* [ë²„íŠ¼ ìŠ¤íƒ€ì¼] */
    .stButton>button { 
        width: 100%; border-radius: 50px; 
        background: linear-gradient(45deg, #1e3a8a, #3b82f6);
        color: white; font-size: 18px; font-weight: bold; height: 4em;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        margin-top: 20px;
    }
    .stButton>button:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
    
    /* [ê²°ê³¼ ì¹´ë“œ ìŠ¤íƒ€ì¼] */
    .result-card { 
        background-color: #1e293b; padding: 25px; border-radius: 15px; 
        border: 1px solid #334155; margin-bottom: 20px; 
    }
    
    /* [ìƒë‹´ ìœ ë„ ë°•ìŠ¤ ìŠ¤íƒ€ì¼] */
    .consult-box { 
        background: linear-gradient(135deg, #1e293b, #0f172a); 
        padding: 40px; border-radius: 20px; border: 2px solid #facc15; 
        text-align: center; margin-top: 30px; margin-bottom: 30px;
    }
    
    /* [í—¤ë” ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€] */
    .streamlit-expanderHeader { 
        background-color: #1e293b !important; color: #60a5fa !important; 
        font-weight: bold !important; border-radius: 10px !important; 
        font-size: 1.1em !important;
    }
    
    /* [ì•Œë¦¼ì°½ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€] */
    .stInfo { background-color: #1e3a8a !important; color: white !important; border-left: 5px solid #facc15 !important; }
    .stSuccess { background-color: #064e3b !important; color: #ecfdf5 !important; }
    .stWarning { background-color: #451a03 !important; color: #fef3c7 !important; }

    /* [ì…ë ¥ì°½ ë””ìì¸] */
    input[type="text"], input[type="number"] {
        background-color: #334155 !important; color: white !important;
        border: 1px solid #64748b !important; caret-color: white !important;
    }
    input:focus { border: 2px solid #facc15 !important; box-shadow: 0 0 10px #facc15 !important; }
    div[data-baseweb="input"] { background-color: #334155 !important; border-radius: 5px !important; }
    div[data-baseweb="select"] > div { background-color: #334155 !important; color: white !important; }
    .stTextInput input, .stDateInput input { color: white !important; }
    
    /* [ê·¸ë˜í”„ ìŠ¤íƒ€ì¼] */
    .stProgress > div > div > div > div { background-image: linear-gradient(to right, #4ade80, #3b82f6); }

    /* [ì‚¬ì£¼ í…Œì´ë¸” ìŠ¤íƒ€ì¼] */
    .saju-table {
        width: 100%; text-align: center; border-collapse: collapse; margin-bottom: 20px; color: white;
    }
    .saju-table th { background-color: #334155; color: #94a3b8; padding: 10px; border: 1px solid #475569; }
    .saju-table td { background-color: #1e293b; color: #facc15; font-size: 1.5em; font-weight: bold; padding: 20px; border: 1px solid #475569; }

    /* [ëª¨ë°”ì¼ ìµœì í™” ë¯¸ë””ì–´ ì¿¼ë¦¬] */
    @media (max-width: 640px) {
        p, div, label, input { font-size: 16px !important; }
        .block-container { padding-left: 1rem !important; padding-right: 1rem !important; }
    }
    </style>
    """, unsafe_allow_html=True)

st.title("ğŸ”® ì‚¬ì£¼ê¹Œê¸° PRO - ë§ˆìŠ¤í„° í‰ìƒ ìš´ì„¸")

# ============================================================================
# [ì„¹ì…˜ 2] ì‚¬ìš©ì ì…ë ¥ (ëª¨ë°”ì¼ ìµœì í™”: ì„¸ë¡œ ë°°ì¹˜)
# ============================================================================
st.write("### ğŸ“… ë¶„ì„ ì—°ë„ ë° ë‚´ ì •ë³´ ì…ë ¥")

# 1. í‰ìƒ ì‚¬ìš©ì„ ìœ„í•œ 'ë¶„ì„ ëŒ€ìƒ ì—°ë„' ì„ íƒ ê¸°ëŠ¥
target_year = st.number_input("ë¶„ì„í•˜ê³  ì‹¶ì€ ì—°ë„ (ì˜ˆ: 2026, 2027, 2028...)", min_value=2025, max_value=2050, value=2026)

# 2. ë‚´ ì •ë³´ ì…ë ¥ (ì„¸ë¡œ ë‚˜ì—´)
u_name_input = st.text_input("ì„±ëª…", placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")
u_name = u_name_input if u_name_input else "ë°©ë¬¸ì"

# 3. ì–‘ë ¥/ìŒë ¥ ì„ íƒ
u_cal_type = st.radio("ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„", ["ì–‘ë ¥", "ìŒë ¥"], horizontal=True, key="u_cal")

# ë‹¬ë ¥ ëŒ€ì‹  ì§ì ‘ ì…ë ¥í•˜ëŠ” ë°©ì‹ (ë…„/ì›”/ì¼ ë¶„ë¦¬)
st.write("â–¼ ì¶œìƒ ìƒë…„ì›”ì¼ (ìˆ«ìë¡œ ì§ì ‘ ì…ë ¥)")
col_uy, col_um, col_ud = st.columns([1.2, 1, 1])
with col_uy:
    u_year = st.number_input("ë…„ë„(Year)", min_value=1900, max_value=2050, value=1960, step=1, format="%d", key="u_y")
with col_um:
    u_month = st.selectbox("ì›”(Month)", list(range(1, 13)), index=5, key="u_m") # ê¸°ë³¸ê°’ 6ì›”
with col_ud:
    u_day = st.number_input("ì¼(Day)", min_value=1, max_value=31, value=26, step=1, format="%d", key="u_d")

# ì…ë ¥ë°›ì€ ë…„/ì›”/ì¼ì„ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
try:
    u_birth = date(u_year, u_month, u_day)
except ValueError:
    st.error("âš ï¸ ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    u_birth = date(1960, 6, 26)

u_time = st.selectbox("ì¶œìƒ ì‹œê°„", [f"{i}ì‹œ" for i in range(24)] + ["ëª¨ë¦„"], index=21) # ê¸°ë³¸ê°’ 21ì‹œ ê·¼ì²˜

# 4. ìƒëŒ€ë°© ì •ë³´ ì…ë ¥ ì˜µì…˜
is_relation = st.checkbox("ğŸ‘¥ ë‚˜ë¡œ ì¸í•œ ìƒê´€ê´€ê³„ (ê¶í•©/ìë…€/ì§€ì¸/ì§ì›ì±„ìš©) í•¨ê»˜ ë³´ê¸°")

t_name, t_birth = "", None
if is_relation:
    st.write("---")
    st.write("### ğŸ‘¥ ë¶„ì„ ëŒ€ìƒ ì •ë³´ ì…ë ¥")
    t_name = st.text_input("ëŒ€ìƒ ì„±ëª…", "ì‹¬ì²­ì´")
    t_cal_type = st.radio("ëŒ€ìƒ ì–‘ë ¥/ìŒë ¥", ["ì–‘ë ¥", "ìŒë ¥"], horizontal=True, key="t_cal")
    
    st.write("â–¼ ëŒ€ìƒ ìƒë…„ì›”ì¼ (ìˆ«ìë¡œ ì§ì ‘ ì…ë ¥)")
    col_ty, col_tm, col_td = st.columns([1.2, 1, 1])
    with col_ty:
        t_year = st.number_input("ëŒ€ìƒ ë…„ë„", min_value=1900, max_value=2050, value=2015, step=1, format="%d", key="t_y")
    with col_tm:
        t_month = st.selectbox("ëŒ€ìƒ ì›”", list(range(1, 13)), key="t_m")
    with col_td:
        t_day = st.number_input("ëŒ€ìƒ ì¼", min_value=1, max_value=31, value=1, step=1, format="%d", key="t_d")
    
    try:
        t_birth = date(t_year, t_month, t_day)
    except ValueError:
        st.error("âš ï¸ ëŒ€ìƒì˜ ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        t_birth = date(2015, 1, 1)

    t_time = st.selectbox("ëŒ€ìƒ ì¶œìƒ ì‹œê°„", [f"{i}ì‹œ" for i in range(24)] + ["ëª¨ë¦„"])

st.write("---")
go = st.button(f"{target_year}ë…„ ì •ë°€ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„± ğŸ”®")


# ============================================================================
# [ì—”ì§„ 1] ì‚¬ìš©ì ë³¸ì›(ë§Œì„¸ë ¥) + ì‹œì£¼(Time) ì •ë°€ ë¶„ì„ ì—”ì§„ (ê¸°ì¤€ì  ì™„ì „ ìˆ˜ì •)
# ============================================================================
def calculate_user_saju(birth_date, time_str="ëª¨ë¦„"):
    # ì²œê°„, ì§€ì§€ ë¦¬ìŠ¤íŠ¸
    chun_gan = ["ê°‘(ç”²)", "ì„(ä¹™)", "ë³‘(ä¸™)", "ì •(ä¸)", "ë¬´(æˆŠ)", "ê¸°(å·±)", "ê²½(åºš)", "ì‹ (è¾›)", "ì„(å£¬)", "ê³„(ç™¸)"]
    ji_ji = ["ì(å­)", "ì¶•(ä¸‘)", "ì¸(å¯…)", "ë¬˜(å¯)", "ì§„(è¾°)", "ì‚¬(å·³)", "ì˜¤(åˆ)", "ë¯¸(æœª)", "ì‹ (ç”³)", "ìœ (é…‰)", "ìˆ (æˆŒ)", "í•´(äº¥)"]
    
    # -------------------------------------------------------------
    # 1. [ë…„ì£¼] Year Pillar ê³„ì‚° (1960 = ê²½ìë…„ ê¸°ì¤€)
    # -------------------------------------------------------------
    # (ë…„ë„ - 4) % 10 = ì²œê°„ ì¸ë±ìŠ¤ (1960-4)%10 = 6 -> ê²½(åºš)
    # (ë…„ë„ - 4) % 12 = ì§€ì§€ ì¸ë±ìŠ¤ (1960-4)%12 = 0 -> ì(å­)
    year_gan_idx = (birth_date.year - 4) % 10
    year_ji_idx = (birth_date.year - 4) % 12
    year_pillar = f"{chun_gan[year_gan_idx]}{ji_ji[year_ji_idx]}ë…„"

    # -------------------------------------------------------------
    # 2. [ì›”ì£¼] Month Pillar ê³„ì‚° (ì—°ë‘ë²• ì ìš©)
    # -------------------------------------------------------------
    # ëŒ€ëµì ì¸ ì ˆê¸° ê¸°ì¤€ (ì¼ë°˜ì ìœ¼ë¡œ ì–‘ë ¥ 6ì¼ ì „í›„)
    # 6ì›” 26ì¼ì€ í•˜ì§€ê°€ ì§€ë‚˜ ì˜¤(åˆ)ì›”ì´ í™•ì‹¤í•¨.
    # ì¸ì›”(2ì›”)ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ (ì›” - 2)
    temp_month_ji = (birth_date.month + 12 - 2) % 12 
    # ì ˆê¸° ë³´ì • (ë‹¨ìˆœí™”: 6ì¼ ì´ì „ì´ë©´ ì „ë‹¬ë¡œ ë´„)
    if birth_date.day < 6:
         temp_month_ji = (temp_month_ji - 1 + 12) % 12
    
    month_ji_idx = (temp_month_ji + 2) % 12 # ì¸(2)ë¶€í„° ì‹œì‘í•˜ëŠ” ì¸ë±ìŠ¤ ë³´ì •
    
    # ì›”ê°„ êµ¬í•˜ê¸° (ì—°ë‘ë²•: ë…„ê°„ì— ì˜í•´ ê²°ì •)
    # ê°‘ê¸°ë…„(0,5) -> ë³‘ì¸ë‘(2)
    # ì„ê²½ë…„(1,6) -> ë¬´ì¸ë‘(4) ... (1960ë…„ì€ ê²½ìë…„ì´ë¯€ë¡œ 6 -> 4 ë¬´ì¸ë‘)
    start_gan_map = {0:2, 1:4, 2:6, 3:8, 4:0, 5:2, 6:4, 7:6, 8:8, 9:0}
    start_month_gan = start_gan_map[year_gan_idx]
    
    # ì¸ì›”ì´ 0ë²ˆì§¸ ìˆœì„œì´ë¯€ë¡œ, ì§€ì§€ ì¸ë±ìŠ¤ì—ì„œ ì¸(2)ì„ ëº€ë§Œí¼ ë”í•¨
    month_offset = (month_ji_idx - 2 + 12) % 12
    month_gan_idx = (start_month_gan + month_offset) % 10
    
    month_pillar = f"{chun_gan[month_gan_idx]}{ji_ji[month_ji_idx]}ì›”"


    # -------------------------------------------------------------
    # 3. [ì¼ì£¼] Day Pillar ê³„ì‚° (ì˜¤ì°¨ ì™„ë²½ ìˆ˜ì •)
    # -------------------------------------------------------------
    # ê¸°ì¤€ì¼: 1960ë…„ 6ì›” 26ì¼ (ë¸”ë£¨ë‚˜ì‡ë‹˜ ìƒì¼) = ê¸°ì‚¬(å·±å·³)ì¼
    # ê¸°(å·±) = ì²œê°„ ì¸ë±ìŠ¤ 5
    # ì‚¬(å·³) = ì§€ì§€ ì¸ë±ìŠ¤ 5
    ref_date = date(1960, 6, 26)
    ref_gan_idx = 5
    ref_ji_idx = 5
    
    days_diff = (birth_date - ref_date).days
    
    gan_idx = (ref_gan_idx + days_diff) % 10 # ì¼ê°„
    ji_idx = (ref_ji_idx + days_diff) % 12  # ì¼ì§€
    
    my_gan = chun_gan[gan_idx]
    my_ji = ji_ji[ji_idx]
    day_pillar = f"{my_gan}{my_ji}ì¼"
    

    # -------------------------------------------------------------
    # 4. [ì‹œì£¼] Time Pillar ê³„ì‚° (ì‹œë‘ë²• ì ìš©)
    # -------------------------------------------------------------
    time_ji_idx = -1
    my_time_ganji = "ì‹œê°„ ëª¨ë¦„"
    time_desc = "íƒœì–´ë‚œ ì‹œê°„ì„ ì•Œë©´ 'ë§ë…„ ìš´'ê³¼ 'ìì‹ ìš´'ì„ ë” ì •í™•íˆ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."

    if time_str != "ëª¨ë¦„":
        hour = int(time_str.replace("ì‹œ", ""))
        # ì‹œê°„ -> 12ì§€ì§€ ì¸ë±ìŠ¤ ë³€í™˜
        if 23 <= hour or hour < 1: time_ji_idx = 0 # ìì‹œ
        elif 1 <= hour < 3: time_ji_idx = 1 # ì¶•ì‹œ
        elif 3 <= hour < 5: time_ji_idx = 2 # ì¸ì‹œ
        elif 5 <= hour < 7: time_ji_idx = 3 # ë¬˜ì‹œ
        elif 7 <= hour < 9: time_ji_idx = 4 # ì§„ì‹œ
        elif 9 <= hour < 11: time_ji_idx = 5 # ì‚¬ì‹œ
        elif 11 <= hour < 13: time_ji_idx = 6 # ì˜¤ì‹œ
        elif 13 <= hour < 15: time_ji_idx = 7 # ë¯¸ì‹œ
        elif 15 <= hour < 17: time_ji_idx = 8 # ì‹ ì‹œ
        elif 17 <= hour < 19: time_ji_idx = 9 # ìœ ì‹œ
        elif 19 <= hour < 21: time_ji_idx = 10 # ìˆ ì‹œ
        else: time_ji_idx = 11 # í•´ì‹œ
        
        # ì‹œë‘ë²•(Time Stem Rule): ì¼ê°„(gan_idx)ì— ë”°ë¼ ì‹œê°„ì˜ ì²œê°„ì´ ê²°ì •ë¨
        # ê°‘ê¸°(0,5)ì¼ -> ê°‘ìì‹œ ì‹œì‘ / ì„ê²½(1,6)ì¼ -> ë³‘ìì‹œ ì‹œì‘ ...
        # ë¸”ë£¨ë‚˜ì‡ë‹˜ì€ ê¸°ì‚¬ì¼(5)ì´ë¯€ë¡œ 0(ê°‘ì)ì‹œ ì‹œì‘ -> í•´ì‹œ(11)ë¼ë©´ ì„í•´ì‹œê°€ ë¨.
        start_time_gan_map = {0:0, 1:2, 2:4, 3:6, 4:8, 5:0, 6:2, 7:4, 8:6, 9:8}
        start_gan = start_time_gan_map[gan_idx]
        time_gan_idx = (start_gan + time_ji_idx) % 10
        
        my_time_ganji = f"{chun_gan[time_gan_idx]} {ji_ji[time_ji_idx]} ì‹œ"
        
        time_luck = [
            "ëŠ¦ì€ ë°¤ ì¥(å­)ì˜ ì‹œê°„: ì§€í˜œë¡­ê³  ì‹ ì¤‘í•˜ë©°, ë§ë…„ì— ì¬ë¬¼ì„ ìˆ¨ê²¨ë‘ëŠ” ì‹¤ì†íŒŒì…ë‹ˆë‹¤.",
            "ìƒˆë²½ ì†Œ(ä¸‘)ì˜ ì‹œê°„: ê·¼ë©´ ì„±ì‹¤í•˜ë©°, ëšì‹¬ ìˆê²Œ ììˆ˜ì„±ê°€í•˜ì—¬ ë§ë…„ì´ í¸ì•ˆí•©ë‹ˆë‹¤.",
            "ìƒˆë²½ í˜¸ë‘ì´(å¯…)ì˜ ì‹œê°„: ì¶”ì§„ë ¥ì´ ê°•í•˜ê³  í™œë™ì ì´ë©°, ëŒ€ê¸°ë§Œì„±í˜•ìœ¼ë¡œ ëª…ì˜ˆë¥¼ ì–»ìŠµë‹ˆë‹¤.",
            "ì•„ì¹¨ í† ë¼(å¯)ì˜ ì‹œê°„: ì¸ì •ì´ ë§ê³  ë‹¤ì •ë‹¤ê°í•˜ë©°, ìì† ë³µì´ ìˆê³  í‰ì˜¨í•œ ì‚¶ì„ ëˆ„ë¦½ë‹ˆë‹¤.",
            "ì˜¤ì „ ìš©(è¾°)ì˜ ì‹œê°„: í¬ë¶€ê°€ í¬ê³  ì´ìƒì´ ë†’ìœ¼ë©°, ì‚¬íšŒì ìœ¼ë¡œ í° ì„±ì·¨ë¥¼ ì´ë£° ê·¸ë¦‡ì…ë‹ˆë‹¤.",
            "ì˜¤ì „ ë±€(å·³)ì˜ ì‹œê°„: ë‘ë‡Œ íšŒì „ì´ ë¹ ë¥´ê³  ê¹”ë”í•˜ë©°, ì „ë¬¸ ë¶„ì•¼ì—ì„œ ì´ë¦„ì„ ë–¨ì¹©ë‹ˆë‹¤.",
            "í•œë‚® ë§(åˆ)ì˜ ì‹œê°„: ì—´ì •ì ì´ê³  í™”ë ¤í•˜ë©°, ì‚¬êµì„±ì´ ì¢‹ì•„ ì¸ê¸°ê°€ ë§ê³  í™œë™ì ì…ë‹ˆë‹¤.",
            "ì˜¤í›„ ì–‘(æœª)ì˜ ì‹œê°„: ì˜¨í™”í•˜ê³  ì¹¨ì°©í•˜ë©°, ì˜ˆìˆ ì  ê°ê°ì´ë‚˜ ê¸°ìˆ ë¡œ ë§ë…„ì— ì•ˆì •ì„ ì°¾ìŠµë‹ˆë‹¤.",
            "ì˜¤í›„ ì›ìˆ­ì´(ç”³)ì˜ ì‹œê°„: ì¬ì£¼ê°€ ë§ê³  ì„ê¸°ì‘ë³€ì´ ë›°ì–´ë‚˜ë©°, ë‹¤ì¬ë‹¤ëŠ¥í•˜ì—¬ êµ¶ì„ ì¼ì´ ì—†ìŠµë‹ˆë‹¤.",
            "ì €ë… ë‹­(é…‰)ì˜ ì‹œê°„: ì˜ˆë¯¼í•˜ì§€ë§Œ ì •í™•í•˜ê³  ê¼¼ê¼¼í•˜ì—¬, ì¬ë¬¼ì„ ì˜ ê´€ë¦¬í•˜ê³  ë¹ˆí‹ˆì´ ì—†ìŠµë‹ˆë‹¤.",
            "ë°¤ ê°œ(æˆŒ)ì˜ ì‹œê°„: ì¶©ì§í•˜ê³  ì‹ ì˜ê°€ ìˆìœ¼ë©°, ê°€ì •ì„ ì˜ ì§€í‚¤ê³  ë‚´ì‹¤ì„ ë‹¤ì§‘ë‹ˆë‹¤.",
            "ë°¤ ë¼ì§€(äº¥)ì˜ ì‹œê°„: ë§ˆìŒì´ ë„“ê³  ì—¬ìœ ê°€ ìˆìœ¼ë©°, ì‹ë³µì´ íƒ€ê³ ë‚˜ ë§ë…„ì´ í’ìš”ë¡­ìŠµë‹ˆë‹¤."
        ]
        time_desc = f"ë‹¹ì‹ ì€ **[{my_time_ganji}]**ì— íƒœì–´ë‚˜ì…¨êµ°ìš”. \nğŸ’¡ {time_luck[time_ji_idx]}"

    # [ê¸°ì¡´ ë°ì´í„° ë³´ì¡´]
    personalities = [
        "ê³§ê²Œ ë»—ì€ ì†Œë‚˜ë¬´(ç”²)ì²˜ëŸ¼ ë¦¬ë”ì‹­ì´ ê°•í•˜ê³  ìì¡´ì‹¬ì´ ì…‰ë‹ˆë‹¤. ì§ì¥ë³´ë‹¤ëŠ” ì‚¬ì—…ì´ë‚˜ ì „ë¬¸ì§ì´ ì–´ìš¸ë¦½ë‹ˆë‹¤.", 
        "ìœ ì—°í•œ í™”ì´ˆ(ä¹™)ì²˜ëŸ¼ ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ê³  ëˆê¸°ê°€ ê°•ì¸í•©ë‹ˆë‹¤. ì¸ë³µì´ ìˆê³  ì™¸ìœ ë‚´ê°•í˜•ì…ë‹ˆë‹¤.", 
        "íƒ€ì˜¤ë¥´ëŠ” íƒœì–‘(ä¸™)ì²˜ëŸ¼ ì—´ì •ì ì´ê³  ì˜ˆì˜ê°€ ë°”ë¥´ë©° ì†”ì§í•©ë‹ˆë‹¤. ì–¸ì œë‚˜ ì¤‘ì‹¬ì— ì„œê¸°ë¥¼ ì¢‹ì•„í•©ë‹ˆë‹¤.", 
        "ì€ì€í•œ ì´›ë¶ˆ(ä¸)ì²˜ëŸ¼ ì„¬ì„¸í•˜ê³  ë”°ëœ»í•˜ë©° ë°°ë ¤ì‹¬ì´ ê¹ŠìŠµë‹ˆë‹¤. ì˜ˆìˆ ì  ì¬ëŠ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.", 
        "ê±°ëŒ€í•œ ì‚°(æˆŠ)ì²˜ëŸ¼ ë¬µì§í•˜ê³  ì‹ ìš©ì„ ì¤‘ì‹œí•˜ë©° í¬ìš©ë ¥ì´ ì¢‹ìŠµë‹ˆë‹¤. ì¤‘ì¬ì ì—­í• ì„ ì˜í•©ë‹ˆë‹¤.", 
        "ë¹„ì˜¥í•œ í…ƒë°­(å·±)ì²˜ëŸ¼ ì‹¤ì† ìˆê³  ë‹¤ì¬ë‹¤ëŠ¥í•˜ë©° êµìœ¡ì ì…ë‹ˆë‹¤. ì‹¤ë¦¬ë¥¼ ì˜ ì±™ê¸°ëŠ” ì‹¤ì†íŒŒì…ë‹ˆë‹¤.", 
        "ë‹¨ë‹¨í•œ ë°”ìœ„(åºš)ì²˜ëŸ¼ ì˜ë¦¬ê°€ ê°•í•˜ê³  ê²°ë‹¨ë ¥ì´ ë¹ ë¦…ë‹ˆë‹¤. í˜ëª…ê°€ì  ê¸°ì§ˆì´ ìˆìŠµë‹ˆë‹¤.", 
        "ë°˜ì§ì´ëŠ” ë³´ì„(è¾›)ì²˜ëŸ¼ ì˜ˆë¯¼í•˜ê³  ê¹”ë”í•˜ë©° ê°ìˆ˜ì„±ì´ í’ë¶€í•©ë‹ˆë‹¤. ì „ë¬¸ê°€ë¡œ ì„±ê³µí•©ë‹ˆë‹¤.", 
        "ë„ë„í•œ ê°•ë¬¼(å£¬)ì²˜ëŸ¼ ì§€í˜œë¡­ê³  ìœ ì—°í•˜ë©° ì„ê¸°ì‘ë³€ì— ê°•í•©ë‹ˆë‹¤. ë¦¬ë”ë‚˜ ì§€ëµê°€ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.", 
        "ìŠ¤ë©°ë“œëŠ” ë¹—ë¬¼(ç™¸)ì²˜ëŸ¼ ì¹˜ë°€í•˜ê³  ì¡°ìš©íˆ ë‚´ì‹¤ì„ ë‹¤ì§€ëŠ” ì§€ëµê°€ì…ë‹ˆë‹¤. ê¸°íšë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤."
    ]
    
    sinsal = ""
    if ji_idx in [0, 6, 3, 9]: sinsal = "âœ¨ ë„í™”ì‚´(æ¡ƒèŠ±æ®º): ì‚¬ëŒì„ ë„ëŠ” ë§¤ë ¥ê³¼ ì¸ê¸°ê°€ ìˆìŠµë‹ˆë‹¤."
    elif ji_idx in [2, 8, 5, 11]: sinsal = "ğŸ ì—­ë§ˆì‚´(é©›é¦¬æ®º): í™œë™ì ì´ê³  ì´ë™ìˆ˜ê°€ ë§ìŠµë‹ˆë‹¤."
    else: sinsal = "ğŸ¨ í™”ê°œì‚´(è¯è“‹æ®º): ì˜ˆìˆ ì  ê°ê°ê³¼ ì¬ì£¼ê°€ ë§ìŠµë‹ˆë‹¤."

    month = birth_date.month
    season_advice = ""
    if month in [3, 4, 5]: season_advice = "ë´„(æ˜¥)ìƒ: ê¸ˆ(é‡‘, í°ìƒ‰) ê¸°ìš´ìœ¼ë¡œ ê°€ì§€ì¹˜ê¸°ë¥¼ í•´ì£¼ë©´ ê²°ì‹¤ì´ ì¢‹ìŠµë‹ˆë‹¤."
    elif month in [6, 7, 8]: season_advice = "ì—¬ë¦„(å¤)ìƒ: ìˆ˜(æ°´, ê²€ì •) ê¸°ìš´ìœ¼ë¡œ ì—´ê¸°ë¥¼ ì‹í˜€ì•¼ ì¬ë¬¼ìš´ì´ ì‚½ë‹ˆë‹¤."
    elif month in [9, 10, 11]: season_advice = "ê°€ì„(ç§‹)ìƒ: í™”(ç«, ë¶‰ì€ìƒ‰) ê¸°ìš´ìœ¼ë¡œ ë”°ëœ»í•˜ê²Œ í•´ì•¼ ì¸ë³µì´ ì˜µë‹ˆë‹¤."
    else: season_advice = "ê²¨ìš¸(å†¬)ìƒ: í™”(ç«, ë¶‰ì€ìƒ‰) ê¸°ìš´ì„ ê°€ê¹Œì´í•´ì•¼ ë§Œë¬¼ì´ ì†Œìƒí•˜ê³  ë°œë³µí•©ë‹ˆë‹¤."

    health_job_db = [
        ("ê°„, ì‹ ê²½ì„±", "ê¸°íš, êµìœ¡, ê±´ì¶•"), ("ìœ„ì¥, í—ˆë¦¬", "ì˜ˆìˆ , ìœ íŠœë¸Œ, ì–¸ë³€"), ("ì‹¬í˜ˆê´€, ì‹œë ¥", "ë°©ì†¡, ì „ì, ë¯¸ë””ì–´"),
        ("ì‹¬ì¥, ì‹œë ¥", "ì •ë°€ê¸°ìˆ , ìƒë‹´, IT"), ("ìœ„ì¥, í”¼ë¶€", "ë¶€ë™ì‚°, ì¤‘ê°œ, ì»¨ì„¤íŒ…"), ("ì†Œí™”ê¸°", "êµìœ¡, ë¹„ì„œ, ë¶€ë™ì‚°"),
        ("í˜¸í¡ê¸°, ë¼ˆ", "êµ°ì¸, ê²½ì°°, ê¸ˆì†"), ("ê¸°ê´€ì§€, í", "ê¸ˆìœµ, ì˜ë£Œ, ë°˜ë„ì²´"), ("ì‹ ì¥, í˜ˆì•¡", "ë¬´ì—­, ìœ í†µ, í•´ìš´"), ("ì‹ ì¥, ìƒì‹ê¸°", "ìš”ì‹ì—…, ì‹¬ë¦¬, ì•½í•™")
    ]
    special_advice_db = [
        "ê°‘ëª©(ç”²)ì˜ ê¸°ê°œë¡œ êµ½íˆì§€ ì•ŠëŠ” ì†Œì‹ ì„ ì§€í‚¤ë˜, ì£¼ë³€ì„ ë³´ëŠ” ì—¬ìœ ë¥¼ ê°€ì§€ì„¸ìš”.", "ì„ëª©(ä¹™)ì˜ ìœ ì—°í•¨ì´ ë¬´ê¸°ì…ë‹ˆë‹¤. ëˆê¸°ë¡œ ê²°êµ­ ìŠ¹ë¦¬í•©ë‹ˆë‹¤.",
        "ë³‘í™”(ä¸™)ì˜ ë¹›ìœ¼ë¡œ ì„¸ìƒì„ ë¹„ì¶”ì„¸ìš”. ë‹¹ì‹ ì˜ ì—´ì •ì´ í¬ë§ì…ë‹ˆë‹¤.", "ì •í™”(ä¸)ì˜ ë”°ìŠ¤í•¨ìœ¼ë¡œ ì‚¬ëŒì„ ì–»ìœ¼ì„¸ìš”. ë°°ë ¤ê°€ ë³µì´ ë©ë‹ˆë‹¤.",
        "ë¬´í† (æˆŠ)ì˜ ì‹ ìš©ì´ ìì‚°ì…ë‹ˆë‹¤. ì‚°ì²˜ëŸ¼ ë²„í‹°ë©´ ì¬ë¬¼ì´ ëª¨ì…ë‹ˆë‹¤.", "ê¸°í† (å·±)ì˜ ì‹¤ì†ì„ ì±™ê¸°ì„¸ìš”. ìì‹ ì„ ê°€ê¾¸ëŠ” ê²ƒì´ ì„±ê³µ ë¹„ê²°ì…ë‹ˆë‹¤.",
        "ê²½ê¸ˆ(åºš)ì˜ ê²°ë‹¨ë ¥ì´ ê¸¸ì„ ì—½ë‹ˆë‹¤. ë§ì„¤ì´ì§€ ë§ê³  ë‚˜ì•„ê°€ì„¸ìš”.", "ì‹ ê¸ˆ(è¾›)ì˜ ì˜ˆë¦¬í•¨ìœ¼ë¡œ ê°€ì¹˜ë¥¼ ì¦ëª…í•˜ì„¸ìš”. ë‹¹ì‹ ì€ ë³´ì„ì…ë‹ˆë‹¤.",
        "ì„ìˆ˜(å£¬)ì˜ ì§€í˜œë¥¼ ë¯¿ìœ¼ì„¸ìš”. ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ë©´ ëª» ë„˜ì„ ì‚°ì´ ì—†ìŠµë‹ˆë‹¤.", "ê³„ìˆ˜(ç™¸)ì˜ ê¾¸ì¤€í•¨ì´ ë‹µì…ë‹ˆë‹¤. ì¹˜ë°€í•˜ê²Œ ë¯¸ë˜ë¥¼ ì„¤ê³„í•˜ì„¸ìš”."
    ]
    lucky_colors = ["ì´ˆë¡ìƒ‰", "ì´ˆë¡ìƒ‰", "ë¶‰ì€ìƒ‰", "ë¶‰ì€ìƒ‰", "ë…¸ë€ìƒ‰", "ë…¸ë€ìƒ‰", "í°ìƒ‰", "í°ìƒ‰", "ê²€ì •ìƒ‰", "ê²€ì •ìƒ‰"]
    
    return {
        "gan": my_gan, "ji": my_ji, "gan_idx": gan_idx, "ji_idx": ji_idx,
        "desc": personalities[gan_idx], "color": lucky_colors[gan_idx],
        "sinsal": sinsal, "season_advice": season_advice, 
        "hj_data": health_job_db[gan_idx], "special_msg": special_advice_db[gan_idx],
        "time_info": time_desc,
        # ì‚¬ì£¼ ì›êµ­ ì „ì²´ ì •ë³´ ë¦¬í„´
        "saju_full": {"year": year_pillar, "month": month_pillar, "day": day_pillar, "time": my_time_ganji}
    }

# ============================================================================
# [ì—”ì§„ 2] í‰ìƒ ìš´ì„¸ ìë™ ìƒì„±ê¸° (2026ë…„ ì´í›„ ì˜êµ¬ ì‚¬ìš© ë¡œì§)
# ============================================================================
def calculate_year_ganji_and_fortune(target_year, user_gan_idx, user_ji_idx):
    # 1. ì…ë ¥ë°›ì€ target_yearì˜ ì²œê°„/ì§€ì§€ ê³„ì‚° (ë§Œì„¸ë ¥ ì•Œê³ ë¦¬ì¦˜)
    # 1900ë…„ = ê²½ìë…„(ì²œê°„6, ì§€ì§€0) ê¸°ì¤€
    t_gan_idx = (6 + (target_year - 1900)) % 10
    t_ji_idx = (0 + (target_year - 1900)) % 12
    
    chun_gan_list = ["ê°‘", "ì„", "ë³‘", "ì •", "ë¬´", "ê¸°", "ê²½", "ì‹ ", "ì„", "ê³„"]
    ji_ji_list = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"]
    
    year_name = f"{chun_gan_list[t_gan_idx]}{ji_ji_list[t_ji_idx]}ë…„"
    year_element_code = t_gan_idx // 2 # 0:ëª©, 1:í™”, 2:í† , 3:ê¸ˆ, 4:ìˆ˜
    my_element = user_gan_idx // 2
    
    fortune_title = ""
    fortune_desc = ""
    
    # 2. ì‹­ì„± ê´€ê³„ ê³„ì‚° (User vs Year)
    diff = (year_element_code - my_element + 5) % 5
    
    # ì‹­ì„±ë³„ ìƒì„¸ í•´ì„ (ë°ì´í„° ëŒ€í­ ë³´ê°•)
    if diff == 0: 
        fortune_title = "ë¹„ê²(ë¹„ê²¬/ê²ì¬) - ì£¼ê´€ê³¼ ê²½ìŸ"
        fortune_desc = f"{target_year}ë…„({year_name})ì€ ë‚˜ì™€ ê°™ì€ ê¸°ìš´ì´ ê°•í•˜ê²Œ ë“¤ì–´ì˜¤ëŠ” í•´ì…ë‹ˆë‹¤. ì£¼ê´€ì´ ëšœë ·í•´ì§€ê³  ë…ë¦½ì‹¬ì´ ê°•í•´ì§€ë©°, ë™ë£Œë‚˜ ì¹œêµ¬ë“¤ê³¼ í˜‘ë ¥í•˜ì—¬ ì¼ì„ ë„ëª¨í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì§€ë‚˜ì¹œ ê³ ì§‘ì€ ê²½ìŸê³¼ ë§ˆì°°ì„ ë¶€ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”. í˜•ì œ, ì¹œêµ¬, ë™ë£Œì™€ì˜ ê´€ê³„ê°€ ì¤‘ìš”í•´ì§€ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
    elif diff == 1: 
        fortune_title = "ì‹ìƒ(ì‹ì‹ /ìƒê´€) - í™œë™ê³¼ í‘œí˜„"
        fortune_desc = f"{target_year}ë…„({year_name})ì€ ë‚˜ì˜ ê¸°ìš´ì„ ë°–ìœ¼ë¡œ í‘œì¶œí•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ê°€ ìƒ˜ì†Ÿê³  í™œë™ë ¥ì´ ì™•ì„±í•´ì ¸ ìƒˆë¡œìš´ ì¼ì„ ê¸°íší•˜ê±°ë‚˜ ì°½ì‘ í™œë™ì— ìµœì ì…ë‹ˆë‹¤. ì˜ì‹ì£¼ê°€ í’ì¡±í•´ì§€ê³  ëŠ¥ë ¥ì„ ì¸ì •ë°›ìœ¼ë‚˜, ë§ì‹¤ìˆ˜ë¥¼ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤."
    elif diff == 2: 
        fortune_title = "ì¬ì„±(í¸ì¬/ì •ì¬) - ì¬ë¬¼ê³¼ ê²°ì‹¤"
        fortune_desc = f"{target_year}ë…„({year_name})ì€ ë‚´ê°€ ê·¹í•˜ê³  ë‹¤ë£¨ëŠ” ê¸°ìš´ìœ¼ë¡œ, ë…¸ë ¥ì˜ ëŒ€ê°€ì¸ ì¬ë¬¼ì´ ë”°ë¥´ëŠ” í•´ì…ë‹ˆë‹¤. ì‚¬ì—… í™•ì¥, íˆ¬ì ìˆ˜ìµ ë“± ê²½ì œì ì¸ ì„±ê³¼ê°€ ê¸°ëŒ€ë˜ë©°, ë‚¨ì„±ì€ ì´ì„±ìš´ë„ í•¨ê»˜ ìƒìŠ¹í•©ë‹ˆë‹¤. í˜„ì‹¤ì ì¸ ê°ê°ì´ ë§¤ìš° ë°œë‹¬í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
    elif diff == 3: 
        fortune_title = "ê´€ì„±(í¸ê´€/ì •ê´€) - ëª…ì˜ˆì™€ ì§ì¥"
        fortune_desc = f"{target_year}ë…„({year_name})ì€ ë‚˜ë¥¼ ê·¹í•˜ëŠ” ê¸°ìš´ì´ ë“¤ì–´ì™€ ì±…ì„ê°ê³¼ ëª…ì˜ˆê°€ ë”°ë¥´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì·¨ì—…, ìŠ¹ì§„, í•©ê²© ë“± ì‚¬íšŒì  ì§€ìœ„ê°€ ìƒìŠ¹í•˜ì§€ë§Œ, ê³¼ë„í•œ ì—…ë¬´ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤. ì—¬ì„±ì€ ë‚¨ì„±ìš´ì´ ë“¤ì–´ì˜¤ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
    else: 
        fortune_title = "ì¸ì„±(í¸ì¸/ì •ì¸) - ë¬¸ì„œì™€ ê³µë¶€"
        fortune_desc = f"{target_year}ë…„({year_name})ì€ ë‚˜ë¥¼ ë„ì™€ì£¼ëŠ” ê¸°ìš´ì´ ê°•í•œ í•´ì…ë‹ˆë‹¤. ìœ—ì‚¬ëŒì˜ ë•ì„ ë³´ê±°ë‚˜ ë¬¸ì„œ ê³„ì•½, ìê²©ì¦ ì·¨ë“, í•™ì—… ì„±ì·¨ì— ë§¤ìš° ìœ ë¦¬í•©ë‹ˆë‹¤. ë‚´ì‹¤ì„ ë‹¤ì§€ë©° ë¯¸ë˜ë¥¼ ì¤€ë¹„í•˜ê¸° ì¢‹ìœ¼ë©°, ë¶€ë™ì‚° ê´€ë ¨ ìš´ë„ ìƒìŠ¹í•©ë‹ˆë‹¤."

    # 3. í•©/ì¶© ë™ì  ê³„ì‚°
    relation_detail = "íŠ¹ë³„í•œ ì¶©ëŒ ì—†ì´ ë¬´ë‚œí•˜ê³  í‰ì˜¨í•œ íë¦„ì´ ì˜ˆìƒë©ë‹ˆë‹¤. ì•ˆì •ì„ ìœ ì§€í•˜ë©° ëª©í‘œë¥¼ í–¥í•´ ë‚˜ì•„ê°€ì„¸ìš”."
    if abs(user_ji_idx - t_ji_idx) == 6:
        relation_detail = f"âš ï¸ {year_name}ì˜ ì§€ì§€ì™€ ë³¸ì¸ì˜ ì¼ì§€ê°€ ì¶©(æ²–)í•˜ì—¬ ë³€í™”ì™€ ë³€ë™ì´ ë§ì€ í•´ì…ë‹ˆë‹¤. ì´ì‚¬, ì´ì§, ì´ë™ìˆ˜ê°€ ê°•í•˜ë‹ˆ ì‹ ì¤‘í•œ íŒë‹¨ì´ í•„ìš”í•©ë‹ˆë‹¤."
    elif (user_ji_idx + t_ji_idx) % 12 == 1: 
        relation_detail = "â¤ï¸ ìœ¡í•©(å…­åˆ)ì´ ë“¤ì–´ì™€ ê·€ì¸ì˜ ë„ì›€ì„ ë°›ê³  ì•ˆì •ì„ ì°¾ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì£¼ë³€ê³¼ í™”í•©í•˜ë©° ìˆœì¡°ë¡œìš´ í•œ í•´ê°€ ë  ê²ƒì…ë‹ˆë‹¤."
    elif (user_ji_idx == 0 and t_ji_idx == 6) or (user_ji_idx == 6 and t_ji_idx == 0): relation_detail = "âš¡ ìì˜¤ì¶©(å­åˆæ²–): ë¬¼ê³¼ ë¶ˆì˜ ì¶©ëŒ, ê°ì • ë³€í™”ì™€ ê±´ê°• ê´€ë¦¬ì— ìœ ì˜í•˜ì„¸ìš”."
    elif (user_ji_idx == 6 and t_ji_idx == 7) or (user_ji_idx == 7 and t_ji_idx == 6): relation_detail = "â¤ï¸ ì˜¤ë¯¸í•©(åˆæœªåˆ): í™”í•©ê³¼ ì•ˆì •ì´ ê¹ƒë“œëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
    
    return year_name, fortune_title, fortune_desc, relation_detail, t_gan_idx

# ============================================================================
# [ì—”ì§„ 3] ì§„ì§œ ë§Œì„¸ë ¥ ì›”ê±´(Monthly) & 10ê°€ì§€ ì‹­ì„± í†µë³€ ì—”ì§„ (ì™„ë²½ ìˆ˜ì •ë¨)
# ============================================================================
def get_monthly_flow_real(target_year_gan_idx, user_gan_idx):
    # 1. ì—°ë‘ë²•(ì›”ê±´): ê·¸ í•´ì˜ ì²œê°„(target_year_gan_idx)ì— ë”°ë¼ 1ì›” ì²œê°„ ê²°ì •
    # ê°‘ê¸°(0,5)ë…„ -> ë³‘ì¸(2)ì›” ì‹œì‘ / ì„ê²½(1,6)ë…„ -> ë¬´ì¸(4)ì›” ì‹œì‘ / ...
    start_gan_map = {0:2, 1:4, 2:6, 3:8, 4:0, 5:2, 6:4, 7:6, 8:8, 9:0}
    start_gan = start_gan_map[target_year_gan_idx]
    
    chun_gan_list = ["ê°‘", "ì„", "ë³‘", "ì •", "ë¬´", "ê¸°", "ê²½", "ì‹ ", "ì„", "ê³„"]
    ji_ji_list = ["ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´", "ì", "ì¶•"] # 1ì›”=ì¸ì›”
    
    monthly_flow = []
    
    # ì‚¬ìš©ì ì¼ê°„(Day Stem) index (0~9)
    # m_gan_idx (ì›”ê°„) index (0~9)
    
    for i in range(12):
        m_gan_idx = (start_gan + i) % 10
        m_gan = chun_gan_list[m_gan_idx]
        m_ji = ji_ji_list[i]
        
        # [í•µì‹¬ ìˆ˜ì •] 5í–‰(ì˜¤í–‰)ìœ¼ë¡œ ë­‰ì¹˜ì§€ ì•Šê³ , 10ì²œê°„ ê°ê°ì˜ ì‹­ì„±ì„ ê³„ì‚°í•˜ì—¬ ë¶„ë¦¬í•¨
        # ì´ë ‡ê²Œ í•´ì•¼ 1ì›”(ë¹„ê²¬)ê³¼ 2ì›”(ê²ì¬)ê°€ ë‹¤ë¥´ê²Œ ë‚˜ì˜µë‹ˆë‹¤.
        
        # ì‹­ì„± ê³„ì‚° ë¡œì§ (ì¼ê°„ ê¸°ì¤€ ì›”ê°„ì˜ ì‹­ì„±) - ì¤‘ë³µ ë°©ì§€
        # (ì›”ê°„ - ì¼ê°„ + 10) % 10 ê°’ì„ ê³ ìœ  í‚¤ë¡œ ì‚¬ìš©í•˜ì—¬ 10ê°€ì§€ ë©˜íŠ¸ë¥¼ ìƒì„±
        
        rel_idx = (m_gan_idx - user_gan_idx + 10) % 10
        
        desc = ""
        # 10ê°€ì§€ ê³ ìœ  í†µë³€ (ì¤‘ë³µ ì—†ìŒ)
        if rel_idx == 0: desc = "ë¹„ê²¬ìš´: ë‚˜ì˜ ì£¼ê´€ì´ ê°•í•´ì§€ê³  ì¹œêµ¬ë‚˜ ë™ë£Œì™€ í˜‘ë ¥í•˜ê±°ë‚˜ ê²½ìŸí•˜ëŠ” ë‹¬ì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ ì†ì—ì„œ ë‚˜ì˜ ì„¸ë ¥ì„ í‚¤ìš°ì„¸ìš”."
        elif rel_idx == 1: desc = "ê²ì¬ìš´: ê²½ìŸì‹¬ì´ ë°œë™í•˜ë©° ì¬ë¬¼ ì§€ì¶œì— ìœ ì˜í•´ì•¼ í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë™ë£Œì™€ì˜ ê´€ê³„ì—ì„œ ì‹¤ì†ì„ ì±™ê²¨ì•¼ í•©ë‹ˆë‹¤."
        elif rel_idx == 2: desc = "ì‹ì‹ ìš´: ì˜ì‹ì£¼ê°€ í’ì¡±í•˜ê³  ë‚˜ì˜ ì¬ëŠ¥ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë°œíœ˜í•˜ëŠ” ì¦ê±°ìš´ ì‹œê¸°ì…ë‹ˆë‹¤. ì°½ì˜ì ì¸ í™œë™ì´ ìœ ë¦¬í•©ë‹ˆë‹¤."
        elif rel_idx == 3: desc = "ìƒê´€ìš´: ê´€ìŠµì„ íƒ€íŒŒí•˜ê³  ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ ë‚´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. í™”ë ¤í•œ ì–¸ë³€ì´ ë‹ë³´ì´ë‚˜ êµ¬ì„¤ìˆ˜ë¥¼ ì¡°ì‹¬í•˜ì„¸ìš”."
        elif rel_idx == 4: desc = "í¸ì¬ìš´: ëœ»ë°–ì˜ ì¬ë¬¼ì´ë‚˜ ì‚¬ì—…ì  ì„±ê³¼ê°€ ë”°ë¥´ë©°, í™œë™ ë²”ìœ„ê°€ ë„“ì–´ì§€ê³  ë°”ë¹ ì§€ëŠ” ì—­ë™ì ì¸ ì‹œê¸°ì…ë‹ˆë‹¤."
        elif rel_idx == 5: desc = "ì •ì¬ìš´: ì„±ì‹¤í•œ ë…¸ë ¥ì˜ ëŒ€ê°€ë¡œ ê³ ì •ì ì¸ ìˆ˜ì…ì´ë‚˜ ì¬ë¬¼ì´ ë“¤ì–´ì˜¤ë©°, ì•ˆì •ì„ ì¶”êµ¬í•˜ëŠ” ì‹¤ì† ìˆëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
        elif rel_idx == 6: desc = "í¸ê´€ìš´: ê³¼ì¤‘í•œ ì—…ë¬´ë‚˜ ì±…ì„ê°ì´ ë”°ë¥´ì§€ë§Œ, ì´ë¥¼ ê·¹ë³µí•˜ë©´ í° ëª…ì˜ˆì™€ ê¶Œìœ„ë¥¼ ì–»ê²Œ ë˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤."
        elif rel_idx == 7: desc = "ì •ê´€ìš´: ìŠ¹ì§„, í•©ê²© ë“± ëª…ì˜ˆìš´ì´ ë”°ë¥´ë©°, ì¡°ì§ ë‚´ì—ì„œ ì‹ ìš©ì„ ì–»ê³  ì•ˆì •ì„ ëˆ„ë¦¬ëŠ” ë°˜ë“¯í•œ ì‹œê¸°ì…ë‹ˆë‹¤."
        elif rel_idx == 8: desc = "í¸ì¸ìš´: ë…íŠ¹í•œ ì•„ì´ë””ì–´ë‚˜ ê¸°ìˆ , ì² í•™ì— ì‹¬ì·¨í•˜ê¸° ì¢‹ìœ¼ë‚˜, ìƒê°ì´ ë§ì•„ì ¸ í™œë™ì„±ì€ ë‹¤ì†Œ ìœ„ì¶•ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        elif rel_idx == 9: desc = "ì •ì¸ìš´: ìœ—ì‚¬ëŒì˜ ë„ì›€ì´ë‚˜ ë¬¸ì„œ ê³„ì•½, í•™ì—… ì„±ì·¨ ë“± ì¸ì •ì„ ë°›ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë§ˆìŒì´ í¸ì•ˆí•´ì§‘ë‹ˆë‹¤."
        
        monthly_flow.append(f"{i+1}ì›”({m_gan}{m_ji}ì›”): {desc}")
        
    return monthly_flow

# --- [4. ì˜¤í–‰ ê·¸ë˜í”„ & ê¸°ë¬¸ ì—”ì§„ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)] ---
def calculate_oheng_graph(birth_date):
    scores = {'ëª©': 10, 'í™”': 10, 'í† ': 10, 'ê¸ˆ': 10, 'ìˆ˜': 10}
    base_date = date(1900, 1, 1)
    days_diff = (birth_date - base_date).days
    gan_idx = (6 + days_diff) % 10 
    
    if gan_idx in [0, 1]: scores['ëª©'] += 30
    elif gan_idx in [2, 3]: scores['í™”'] += 30
    elif gan_idx in [4, 5]: scores['í† '] += 30
    elif gan_idx in [6, 7]: scores['ê¸ˆ'] += 30
    elif gan_idx in [8, 9]: scores['ìˆ˜'] += 30
    
    month = birth_date.month
    if month in [3, 4, 5]: scores['ëª©'] += 20
    elif month in [6, 7, 8]: scores['í™”'] += 20
    elif month in [9, 10, 11]: scores['ê¸ˆ'] += 20
    elif month in [12, 1, 2]: scores['ìˆ˜'] += 20
    return scores

def get_gimun(birth_date):
    val = (birth_date.year + birth_date.month + birth_date.day) % 9
    if val == 0: val = 9
    g_data = {
        1: ("ì¼ë°±ìˆ˜", "ì§€í˜œ/ì² í•™", "ê¹Šì€ ë¬¼ì²˜ëŸ¼ ì†ì„ ì•Œ ìˆ˜ ì—†ëŠ” ì§€í˜œì™€ ìœ ì—°í•¨ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤."), 
        2: ("ì´í‘í† ", "ì•ˆì •/ê¸°ë°˜", "ëŒ€ì§€ì²˜ëŸ¼ ë§Œë¬¼ì„ í’ˆì–´ì£¼ëŠ” ëª¨ì„±ì• ì™€ ëˆê¸°ê°€ ìˆìŠµë‹ˆë‹¤."), 
        3: ("ì‚¼ë²½ëª©", "ì‹œì‘/ì¶”ì§„", "ì²œë‘¥ì²˜ëŸ¼ ëš«ê³  ë‚˜ê°€ëŠ” ê°•ë ¥í•œ ê¸°íšë ¥ê³¼ ì‹¤í–‰ë ¥ì´ ìˆìŠµë‹ˆë‹¤."),
        4: ("ì‚¬ë¡ëª©", "êµë¥˜/ì‹ ìš©", "ë°”ëŒì²˜ëŸ¼ ì–´ë””ë“  í†µí•˜ëŠ” ì‚¬êµì„±ê³¼ ë¶€ë“œëŸ¬ìš´ ì¹´ë¦¬ìŠ¤ë§ˆê°€ ìˆìŠµë‹ˆë‹¤."), 
        5: ("ì˜¤í™©í† ", "ì¤‘ì‹¬/ì œì™•", "í™©ì œì²˜ëŸ¼ ì¤‘ì•™ì—ì„œ ì „ì²´ë¥¼ í†µì†”í•˜ëŠ” ê°•ë ¥í•œ ë¦¬ë”ì‹­ì´ ìˆìŠµë‹ˆë‹¤."), 
        6: ("ìœ¡ë°±ê¸ˆ", "ê¶Œìœ„/ê²°ë‹¨", "í•˜ëŠ˜ì˜ ë²•ì²˜ëŸ¼ ê³µì •í•˜ê³  ëƒ‰ì² í•œ íŒë‹¨ë ¥ê³¼ ê²°ë‹¨ë ¥ì´ ìˆìŠµë‹ˆë‹¤."),
        7: ("ì¹ ì ê¸ˆ", "ì–¸ë³€/ì¬ì¹˜", "ì…ì„ í†µí•´ ì¦ê±°ì›€ì„ ì£¼ê³  ì„¤ë“í•˜ëŠ” ë›°ì–´ë‚œ ì–¸ë³€ì´ ìˆìŠµë‹ˆë‹¤."), 
        8: ("íŒ”ë°±í† ", "ê°œí˜/ëšì‹¬", "ë†’ì€ ì‚°ì²˜ëŸ¼ ë¬µë¬µíˆ ë²„í‹°ë©° ê²°êµ­ ì´ë£¨ì–´ë‚´ëŠ” ê°œí˜ê°€ì…ë‹ˆë‹¤."), 
        9: ("êµ¬ìí™”", "ëª…ì˜ˆ/ì—´ì •", "íƒ€ì˜¤ë¥´ëŠ” ë¶ˆê½ƒì²˜ëŸ¼ í™”ë ¤í•¨ì„ ì¶”êµ¬í•˜ê³  ëª…ì˜ˆë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤.")
    }
    return val, g_data[val]

# ============================================================================
# [ë©”ì¸ ì‹¤í–‰ ë¡œì§]
# ============================================================================
if go:
    res_area = st.container()
    with st.spinner(f'{target_year}ë…„ì˜ ì²œê¸°ì™€ ê·€í•˜ì˜ ì‚¬ì£¼ë¥¼ ì •ë°€ ëŒ€ì¡° ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...'):
        time.sleep(1.0)
        
        # 1. ë‚´ ì •ë³´ ë¶„ì„ (ì‹œê°„ í¬í•¨!) - ì—¬ê¸°ê°€ ìˆ˜ì •ëœ í•µì‹¬ í¬ì¸íŠ¸ì…ë‹ˆë‹¤!
        my_data = calculate_user_saju(u_birth, u_time)
        g_num, (g_title, g_key, g_desc) = get_gimun(u_birth)
        oheng_scores = calculate_oheng_graph(u_birth)
        
        # 2. [í‰ìƒ ìš´ì„¸] ì„ íƒí•œ ì—°ë„(Target Year) ë¶„ì„ + ì›”ê±´ ê³„ì‚° (ì™„ë²½ ìˆ˜ì •)
        t_year_name, t_fortune_title, t_fortune_desc, t_relation_luck, t_gan_idx = calculate_year_ganji_and_fortune(target_year, my_data['gan_idx'], my_data['ji_idx'])
        
        # [NEW] ì„ íƒí•œ ì—°ë„ì— ë§ëŠ” ì‹¤ì œ ì›”ë³„ ê°„ì§€ + ì‹­ì„± í†µë³€ ìƒì„±
        monthly_data = get_monthly_flow_real(t_gan_idx, my_data['gan_idx'])
        
        # 3. ìƒëŒ€ë°© ë¶„ì„ ë°ì´í„° ì¤€ë¹„ (ì¡´ì¬ ì‹œ)
        if is_relation:
            # ìƒëŒ€ë°©ë„ ì‹œê°„ì„ ë„£ì–´ì„œ ê³„ì‚°í•˜ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!
            t_data = calculate_user_saju(t_birth, t_time)

    with res_area:
        st.subheader(f"âœ¨ {u_name}ë‹˜ì„ ìœ„í•œ {target_year}ë…„({t_year_name}) ì •ë°€ ë¦¬í¬íŠ¸")
        
        # 1. ì‚¬ì£¼ ì›êµ­
        with st.expander("ğŸ“… 1. íƒ€ê³ ë‚œ ì‚¬ì£¼ ì›êµ­ (ë‚˜ëŠ” ëˆ„êµ¬ì¸ê°€?)", expanded=True):
            st.markdown(f"<h1 style='text-align:center; color:#facc15;'>{my_data['gan']}{my_data['ji']}</h1>", unsafe_allow_html=True)
            st.caption("â–² ë³¸ì¸ì˜ ì¼ì£¼ (íƒ€ê³ ë‚œ ê¸°ìš´)")
            
            # ì‚¬ì£¼ ì „ì²´ ë³´ì—¬ì£¼ê¸° (ë…„/ì›”/ì¼/ì‹œ)
            s = my_data['saju_full']
            st.markdown(f"""
                <table class="saju-table">
                    <tr><th>ì‹œì£¼ (Time)</th><th>ì¼ì£¼ (Day)</th><th>ì›”ì£¼ (Month)</th><th>ë…„ì£¼ (Year)</th></tr>
                    <tr>
                        <td>{s['time']}</td>
                        <td style="color:#facc15; border: 2px solid #facc15;">{s['day']}</td>
                        <td>{s['month']}</td>
                        <td>{s['year']}</td>
                    </tr>
                    <tr><td>ë§ë…„/ìì‹</td><td>ë‚˜ ìì‹ (ë³¸ì›)</td><td>ì‚¬íšŒ/ë¶€ëª¨</td><td>ì¡°ìƒ/ì´ˆë…„</td></tr>
                </table>
            """, unsafe_allow_html=True)

            st.write(f"**íƒ€ê³ ë‚œ ì„±í–¥:** {my_data['desc']}")
            st.info(f"ğŸ’¡ {my_data['sinsal']}")
            st.success(my_data['time_info'])
        
        # 2. ì„ íƒí•œ ì—°ë„(í‰ìƒ) ìš´ì„¸
        with st.expander(f"ğŸ”¥ 2. {target_year}ë…„ {t_year_name} í•µì‹¬ ìš´ì„¸"):
            st.markdown(f"### {target_year}ë…„ì€ **[{t_fortune_title}]**ì˜ í•´ì…ë‹ˆë‹¤.")
            st.success(f"{t_fortune_desc}")
            st.warning(f"âš ï¸ **ì˜¬í•´ì˜ ì¡°ì–¸:** {t_relation_luck}")

        # 3. ê¸°ë¬¸ì •ëª…í•™
        with st.expander(f"ğŸ”® 3. [íŠ¹ê¸‰] ê¸°ë¬¸ì •ëª…í•™ í•´ë‹¨ (ì„ ì²œìˆ˜ {g_num})"):
            st.markdown(f"### **{g_title} - {g_key}**")
            st.write(g_desc)
            st.write("íƒ€ê³ ë‚œ ëª…êµ­(å‘½å±€)ì´ ì¤‘ê¶ì˜ í˜ì„ ë°›ì•„ ì‚¬ë°©ìœ¼ë¡œ ë»—ì–´ë‚˜ê°€ëŠ” ê¸°ì„¸ì…ë‹ˆë‹¤.")

        # [4. ìƒëŒ€ë°© ë¶„ì„ - ì™„ë²½ ë³µêµ¬ ë° ì‚½ì… ì™„ë£Œ]
        # (ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí–ˆì„ ë•Œë§Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤)
        if is_relation:
            with st.expander(f"ğŸ‘¥ 4. {t_name}ë‹˜ê³¼ì˜ ê´€ê³„ ë¶„ì„ (ë‚˜ì™€ ìƒëŒ€ë°©)"):
                st.markdown("### â¤ï¸ ê¶í•© ë° ê´€ê³„ ì •ë°€ ì§„ë‹¨")
                t_s = t_data['saju_full']
                st.write(f"ìƒëŒ€ë°©({t_name})ë‹˜ì€ **{t_s['day']} ({t_data['gan']}{t_data['ji']}) ì¼ì£¼**ì…ë‹ˆë‹¤.")
                st.write(f"**ì„±í–¥:** {t_data['desc']}")
                
                # ì‹¬ì¸µ ê´€ê³„ ë¶„ì„ ë¡œì§ (ë°ì´í„° ê¸¸ì´ í™•ë³´)
                rel_comment = "ì„œë¡œì˜ ë¶€ì¡±í•œ ë¶€ë¶„ì„ ì±„ì›Œì¤„ ìˆ˜ ìˆëŠ” ìƒí˜¸ ë³´ì™„ì ì¸ ê´€ê³„ì…ë‹ˆë‹¤."
                if my_data['gan'] == t_data['gan']:
                    rel_comment = "ì¹œêµ¬ì²˜ëŸ¼ í¸ì•ˆí•˜ê³  ë™ë“±í•œ 'ë¹„ê²¬' ê´€ê³„ì…ë‹ˆë‹¤. ê³µê°ëŒ€ê°€ ì˜ í˜•ì„±ë©ë‹ˆë‹¤."
                
                st.info(f"ğŸ’¡ **ê´€ê³„ ì¡°ì–¸:** {rel_comment}")
                st.write("---")
                st.write(f"**ìƒëŒ€ë°© ì‹œê°„ ë¶„ì„:** {t_data['time_info']}")

        # 5. ì›”ë³„ íë¦„ (ì„¸ë¡œ ë‚˜ì—´ - ì‹¤ì œ ë§Œì„¸ë ¥ ì›”ê±´ + 10ê°€ì§€ ì‹­ì„± í†µë³€ ì ìš©)
        with st.expander(f"ğŸ“† 5. {target_year}ë…„({t_year_name}) ì›”ë³„ ìƒì„¸ íë¦„"):
            st.write(f"**{t_year_name}**ì˜ ì²œê°„ ê¸°ìš´ê³¼ ë³¸ì¸ì˜ ì¼ê°„ì„ ëŒ€ì¡°í•˜ì—¬ ì‚°ì¶œëœ ì •ë°€ ì›”ë³„ ìš´ì„¸ì…ë‹ˆë‹¤.")
            for m_desc in monthly_data:
                st.write(f"- {m_desc}")

        # 6. ì˜¤ëŠ˜ì˜ ìš´ì„¸ (ê°œìš´ë²•) - [ë§¤ì¼ ë°”ë€Œë„ë¡ ì—…ê·¸ë ˆì´ë“œ ë¨]
        with st.expander("ğŸ€ 6. ì˜¤ëŠ˜ì˜ í–‰ìš´ (ë§¤ì¼ ë°”ë€ë‹ˆë‹¤!)"):
            # ì˜¤ëŠ˜ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
            today = date.today()
            
            # [ë§¤ì¼ ë°”ë€ŒëŠ” ë¡œì§] ì˜¤ëŠ˜ ë‚ ì§œ ìˆ«ì + ë‚´ ì‚¬ì£¼ ì ìˆ˜(gan_idx)ë¥¼ ë”í•´ì„œ 'ì˜¤ëŠ˜ì˜ ëœë¤ ì”¨ì•—'ì„ ë§Œë“¦
            daily_seed = today.year + today.month + today.day + my_data['gan_idx']
            
            # 1. ì˜¤ëŠ˜ì˜ ìƒ‰ìƒ (8ê°€ì§€ ì¤‘ ë¡œí…Œì´ì…˜)
            color_list = ["ì—´ì •ì˜ ë¹¨ê°„ìƒ‰", "ì°¨ë¶„í•œ íŒŒë€ìƒ‰", "ë°ì€ ë…¸ë€ìƒ‰", "ê¹¨ë—í•œ í°ìƒ‰", "ì‹œí¬í•œ ê²€ì€ìƒ‰", "ì‹ ë¹„ë¡œìš´ ë³´ë¼ìƒ‰", "ìƒê¸° ìˆëŠ” ì´ˆë¡ìƒ‰", "ë¶€ìœ í•œ í™©ê¸ˆìƒ‰"]
            today_color = color_list[daily_seed % 8]
            
            # 2. ì˜¤ëŠ˜ì˜ ìˆ«ì (1~9)
            today_num = (daily_seed % 9) + 1
            
            # 3. ì˜¤ëŠ˜ì˜ ë°©í–¥ (8ë°©ìœ„)
            dir_list = ["ë™ìª½", "ì„œìª½", "ë‚¨ìª½", "ë¶ìª½", "ë™ë‚¨ìª½", "ë™ë¶ìª½", "ì„œë‚¨ìª½", "ì„œë¶ìª½"]
            today_dir = dir_list[daily_seed % 8]

            st.info(f"ğŸ“… **{today.month}ì›” {today.day}ì¼**, {u_name}ë‹˜ì„ ìœ„í•œ í–‰ìš´ì˜ ì²˜ë°©ì…ë‹ˆë‹¤.")
            st.write(f"ğŸ¨ í–‰ìš´ì˜ ìƒ‰ìƒ: **{today_color}**")
            st.write(f"ğŸ”¢ í–‰ìš´ì˜ ìˆ«ì: **{today_num}**")
            st.write(f"ğŸ§­ í–‰ìš´ì˜ ë°©í–¥: **{today_dir}**")
            st.caption(f"â€» ì´ ê²°ê³¼ëŠ” ë§¤ì¼ ìì •ì´ ì§€ë‚˜ë©´ ë‚´ ì‚¬ì£¼ íë¦„ì— ë§ì¶° ìƒˆë¡­ê²Œ ë°”ë€ë‹ˆë‹¤.")

        # 7. ì¬ë¬¼/ê±´ê°•/ì§ì—… (ì„¸ë¡œ ë‚˜ì—´)
        with st.expander("ğŸ’° 7. ì¬ë¬¼Â·ê±´ê°•Â·ì§ì—… ì •ë°€ ë¶„ì„"):
            health_txt, job_txt = my_data['hj_data']
            st.markdown("### ğŸ¥ ê±´ê°• ê´€ë¦¬ ë¹„ë²•")
            st.warning(f"**ì£¼ì˜:** {health_txt} ìª½ì— ìœ ì˜í•˜ë©°, ë¯¸ë¦¬ ê±´ê°•ê²€ì§„ì„ ì±™ê¸°ì„¸ìš”.")
            st.write("---")
            st.markdown("### ğŸ’¼ ì§ì—… ë° ì¬ë¬¼ ìš´")
            st.success(f"**ì¶”ì²œ ë¶„ì•¼:** {job_txt} ë¶„ì•¼ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

        # 8. ê°œì¸ ê¸°ìš´ ë¶„ì„ (ì„¸ë¡œ ë‚˜ì—´ & ê·¸ë˜í”„)
        with st.expander("ğŸ¯ 8. ë‚˜ë§Œì˜ ì˜¤í–‰(äº”è¡Œ) ì—ë„ˆì§€ ë¶„í¬ë„"):
            st.write(f"**{u_name}**ë‹˜ì˜ ì‚¬ì£¼ì— ë‚´ì¬ëœ ì˜¤í–‰ ì—ë„ˆì§€ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤.")
            st.write(f"ğŸŒ² ëª©(ë‚˜ë¬´): {oheng_scores['ëª©']}%")
            st.progress(min(oheng_scores['ëª©'], 100))
            st.write(f"ğŸ”¥ í™”(ë¶ˆ): {oheng_scores['í™”']}%")
            st.progress(min(oheng_scores['í™”'], 100))
            st.write(f"â›°ï¸ í† (í™): {oheng_scores['í† ']}%")
            st.progress(min(oheng_scores['í† '], 100))
            st.write(f"âš”ï¸ ê¸ˆ(ì‡ ): {oheng_scores['ê¸ˆ']}%")
            st.progress(min(oheng_scores['ê¸ˆ'], 100))
            st.write(f"ğŸ’§ ìˆ˜(ë¬¼): {oheng_scores['ìˆ˜']}%")
            st.progress(min(oheng_scores['ìˆ˜'], 100))
            st.caption("â€» ê·¸ë˜í”„ê°€ ë†’ì€ ê¸°ìš´ì€ ì¥ì ì´ë‚˜, ë„ˆë¬´ ê³¼í•˜ë©´ ì˜¤íˆë ¤ ë…ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

        # 9. íŠ¹ë³„ ì¡°ì–¸ (ì¼ê°„ë³„ ë§ì¶¤í˜•)
        with st.expander("ğŸ“ 9. ì‚¬ì£¼ê¹Œê¸°ì˜ íŠ¹ë³„ ì¡°ì–¸"):
            st.markdown(f"### ğŸ’Œ {u_name}ë‹˜ì„ ìœ„í•œ í•œë§ˆë””")
            st.success(f"{my_data['special_msg']}")

        # --- [ìƒë‹´ ì„¹ì…˜: ì™„ë²½ ë³µêµ¬] ---
        st.markdown("---")
        st.markdown("""
            <div class='consult-box'>
                <h2 style='color: #facc15;'>ğŸ”® "ë‚´ ì‚¬ì£¼ì— ë”± ë§ëŠ” ë” ê¹Šì€ í•´ë‹µ"ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h2>
                <p style='font-size: 1.2em; color: white; margin-top: 10px;'>
                    ê·¸ë ‡ë‹¤ë©´ ì§€ê¸ˆ <b>010-8393-7471 ìƒë‹´ì˜ˆì•½</b> ë˜ëŠ” <b>QRì„ ìŠ¤ìº”</b> í•˜ì„¸ìš”
                </p>
            </div>
        """, unsafe_allow_html=True)

        _, col_qr, _ = st.columns([1.2, 1, 1.2]) 
        with col_qr:
            qr_path = "my_QR.jpg"
            desktop_path = os.path.join(os.path.expanduser("~"), "Desktop", "my_QR.jpg")    
             
            if os.path.exists(qr_path):
                st.image(qr_path, width=300)
                st.markdown("<p style='text-align: center; font-weight: bold; color: #facc15; font-size: 1.2em;'>ì‚¬ì£¼ê¹Œê¸° ì „ë¬¸ê°€ ìƒë‹´ QR</p>", unsafe_allow_html=True)
            elif os.path.exists(desktop_path):
                st.image(desktop_path, width=300)
                st.markdown("<p style='text-align: center; font-weight: bold; color: #facc15; font-size: 1.2em;'>ì‚¬ì£¼ê¹Œê¸° ì „ë¬¸ê°€ ìƒë‹´ QR</p>", unsafe_allow_html=True)
            else:
                st.info("âš ï¸ 'my_QR.jpg' ì‚¬ì§„ì„ ì´ í´ë”ë‚˜ ë°”íƒ•í™”ë©´ì— ë„£ì–´ì£¼ì„¸ìš”.")

st.write("---")
st.info("ğŸ’¡ ë³¸ ë¦¬í¬íŠ¸ëŠ” ì‚¬ì£¼ê¹Œê¸° ë‹˜ì˜ ìŒì–‘ì˜¤í–‰ ì •ë°€ ì•Œê³ ë¦¬ì¦˜ì„ ë°”íƒ•ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")